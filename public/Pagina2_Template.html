<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
      body { padding: 1.5rem; font-size: 0.9rem; }
      .question-group { margin-bottom: 20px; border-left: 3px solid #007bff; padding-left: 15px; }
      h5 { color: #007bff; border-bottom: 1px solid #dee2e6; padding-bottom: 5px; margin-top: 1.5rem; }
      .question-row { display: flex; align-items: center; margin-bottom: 8px; flex-wrap: wrap; padding: 5px; border-radius: 5px; }
      .question-text { flex-grow: 1; min-width: 300px; padding-right: 10px; }
      .responses { min-width: 180px; text-align: right; }
      .obs-input { margin-left: 10px; flex-basis: 200px; flex-grow: 1; }
      .btn-block { width: 100%; font-size: 1.2rem; }
      .form-check-label { margin-right: 10px; }
      .unanswered { border: 2px solid red !important; }
    </style>
</head>
<body>
<div class="container-fluid">
    <h4 id="questionario-titulo">Questionário de Avaliação</h4>
    <form id="formCompleto" novalidate>
        <div id="questionario-container"></div>
        <hr/>
        <div class="form-row">
          <div class="col">
            <button type="button" class="btn btn-secondary btn-block" onclick="voltarParaPagina1()">← Voltar</button>
          </div>
          <div class="col">
            <button type="button" class="btn btn-success btn-block" id="btnSalvar">Salvar Avaliação Completa</button>
          </div>
        </div>
    </form>
</div>

<script>
  // A constante ESTRUTURA_FORMULARIO completa vai aqui
  const ESTRUTURA_FORMULARIO = {
    Clinico: [ { titulo: 'Identificação do Paciente', perguntas: [ { id: 'Id_NomeCompleto', texto: 'Nome Completo:' }, { id: 'Id_DataNasc', texto: 'Data de nascimento:'}, {id: 'Id_Sexo', texto: 'Sexo'}, { id: 'Id_NomeMae', texto: 'Nome da mãe:' }, { id: 'Id_Endereco', texto: 'Endereço:' } ] }, { titulo: 'Triagem', perguntas: [ { id: 'Triagem_Realizada', texto: 'Foi realizado triagem?' }, { id: 'Triagem_ClassificacaoCorreta', texto: 'Realizada classificação pelo Protocolo de Manchester?'} ] }, { titulo: 'HDA', perguntas: [ { id: 'HDA_QuadroClinico', texto: 'Possui quadro clínico do paciente?' }, { id: 'HDA_CondutaMedica', texto: 'Possui conduta proposta pelo médico?' }, { id: 'HDA_ExameFisico', texto: 'Possui exame físico do paciente?' }, { id: 'HDA_SinalComorbidades', texto: 'Possui sinalização de comorbidades?' }, { id: 'HDA_SinalAlergias', texto: 'Possui sinalização de alergias?' }, { id: 'HDA_HipoteseDiagnostica', texto: 'Possui Hipotese Diagnóstica?' }, {id: 'HDA_ExamesComplementares', texto: 'Exames complementares solicitados?'} ] }, { titulo: 'Reconciliação medicamentosa na admissão', perguntas: [ { id: 'Reconciliacao_MedsUso', texto: 'Possui medicações que paciente faz o uso?' }, { id: 'Reconciliacao_HorarioDose', texto: 'Possui horário da dose?' }, { id: 'Reconciliacao_Frequencia', texto: 'Possui frequência?' }, { id: 'Reconciliacao_SinalAlergias', texto: 'Possui sinalização de alergias?' }, { id: 'Reconciliacao_ManterMed', texto: 'Possui a informação se a medicação deve ser mantida ou não? Conciliado na prescrição? Há justificativa em caso de suspensão?'} ] }, { titulo: 'Check list de Transporte Seguro - SBAR', perguntas: [ { id: 'Transporte_Diagnostico', texto: 'Possui diagnóstico?' }, { id: 'Transporte_SinalAlergias', texto: 'Possui sinalização de alergias?' }, { id: 'Transporte_SinalPrecaucoes', texto: 'Possui sinalização de precauções?' }, {id: 'Transporte_MotivoTransferencia', texto: 'Motivo da transferência registrado?'}, { id: 'Transporte_UnidadeOrigem', texto: 'Possui unidade de origem?' }, { id: 'Transporte_UnidadeDestino', texto: 'Possui unidade de destino?' }, { id: 'Transporte_IdRiscos', texto: 'Possui identificações dos riscos?' }, { id: 'Transporte_SSVVAtualizado', texto: 'Possui SSVV atualizados?' }, { id: 'Transporte_Criterios', texto: 'Possui critérios do transporte?'}, {id: 'Transporte_RecomendacoesPreenchidas', texto: 'Possui recomendações preenchidas para o setor de destino?'} ] }, { titulo: 'Aplicação do Algoritmo de TEV', perguntas: [ { id: 'TEV_Avaliacao24h', texto: 'Realizado avaliação médica de TEV nas primeiras 24hrs?' }, { id: 'TEV_PrescricaoProtocolo', texto: 'Prescrição esta conforme estabelecido no protocolo?' }, { id: 'TEV_ReavaliacaoEnfermagem', texto: 'Houve reavaliação diária pela equipe de enfermagem?' } ] }, { titulo: 'SAE ( sistematização da assistência de enfermagem)', perguntas: [ { id: 'SAE_HistoricoEnf', texto: 'Possui histórico de enfermagem preenchido integralmente?' }, { id: 'SAE_DiagnosticoEnf', texto: 'Possui diagnóstico de enfermagem?' }, { id: 'SAE_CuidadosPrescritos', texto: 'Possui cuidados de enfermagem prescritos de acordo com os riscos e diagnósticos?' } ] }, { titulo: 'Avaliação de riscos', perguntas: [ { id: 'Riscos_AvaliacaoQueda', texto: 'Possui avaliação do risco de queda?' }, { id: 'Riscos_AvaliacaoLesaoPele', texto: 'Possui avaliação do risco de lesão de pele?'}, {id: 'Riscos_AvaliacaoBroncoaspiracao', texto: 'Possui avaliação do risco de broncoaspiração?'} ] }, { titulo: 'Plano terapeutico médico', perguntas: [ { id: 'PlanoMedico_BemDefinido', texto: 'Possui plano terapêutico médico descrito?' } ] }, { titulo: 'Plano terapeutico multidisciplinar', perguntas: [ { id: 'PlanoMulti_Existente', texto: 'Possui plano terapêutico multidisciplinar?' }, { id: 'PlanoMulti_Metas', texto: 'Possui metas a serem alcançadas?' }, { id: 'PlanoMulti_Reavaliacao', texto: 'Possui reavaliação?' }, { id: 'PlanoMulti_TodasCategorias', texto: 'Possui plano terapêutico multidisciplinar de todas as categorias que prestam assistência a esse paciente? Caso tenha identificado alguma especialidade que não fez o plano, inserir essa infomação no campo de observações' } ] }, { titulo: 'Plano de cuidado paciente e família', perguntas: [ { id: 'PlanoCuidado_InfoRelevante', texto: 'Possui plano de cuidado paciente e familia com informações relevantes?' } ] }, { titulo: 'Evolução de enfermagem', perguntas: [ { id: 'EvolucaoEnf_InfoClara', texto: 'A evolução contempla a avaliação do paciente baseada nos problemas identificados (ex.: dor, integridade da pele, sinais vitais alterados)? Descreve ações/intervenções de enfermagem realizadas e a resposta do paciente?' } ] }, { titulo: 'Anotação de enfermagem', perguntas: [ { id: 'AnotacaoEnf_InfoClara', texto: 'A anotação do técnico de enfermagem possui precauções, dispositivos, acessos vasculares, registro de condutas realizadas durante o plantão (banho, mudança de decúbito, etc)? Caso tenha identificado alguma não conformidade, inserir a informação no campo de observação.'} ] }, { titulo: 'Evolução médica de adimissão', perguntas: [ { id: 'EvolucaoMedica_InfoClara', texto: 'A evolução médica possui informações claras e concisas referente ao diagnóstico do paciente? Caso tenha identificado alguma não conformidade, inserir a informação no campo de observação.' } ] }, { titulo: 'Eventos adversos', perguntas: [ { id: 'Eventos_Identificado', texto: 'Durante sua avaliação de prontuário foi identificado algum evento adverso? Se sim, inserir no campo de observações qual evento' }, { id: 'Eventos_Notificado', texto: 'Foi notificado? Existe evidência de notificação em prontuário?' } ] }, { titulo: 'Sumário de Alta', perguntas: [ { id: 'Alta_Sumario', texto: 'Possui sumário de alta?' }, { id: 'Alta_Orientacoes', texto: 'Possui orientações de alta?' }, { id: 'Alta_Especialidade', texto: 'Qual a especialidade?' } ] }, { titulo: 'Siglas', perguntas: [ { id: 'Final_UsoInadequadoSiglas', texto: 'Todas as siglas evidenciadas nos registros estão padronizadas em siglário da instituição?'} ] }, { titulo: 'Avaliação de Risco de Suicídio', perguntas: [ { id: 'Suicidio_DocumentoAberto', texto: 'Documento aberto no pronto socorro, com preenchimento integral do formulário e identificação dos fatores de risco pelo enfermeiro?'}, {id: 'Suicidio_SinalizadoProtocolo', texto: 'Se necessário o acionamento da psicologia para realização da Etapa 2 (Avaliação e Classificação do Risco de Suicídio), esta etapa foi sinalizada no protocolo? Realizado parecer?'}, {id: 'Suicidio_SinalizacaoBarreiras', texto: 'Se risco evidenciado, a aplicação das barreiras de prevenção foram sinalizadas no formulário?'}, {id: 'Suicidio_FormularioPreenchido', texto: 'Na trasnferência do paciente ao setor de destino, o formulário foi preenchido integralmente?'}, {id: 'Suicidio_ParecerPsicologia', texto: 'Se necessário avaliação da psicologia, houve realização de parecer? Consta registro do atendimento em prontuário?'}, {id: 'Suicidio_ParecerPsiquiatria', texto: 'Se necessário avaliação da psiquiatria, houve realização de parecer? Consta registro do atendimento em prontuário?'} ] }, { titulo: 'Protocolos Gerenciados', perguntas: [ { id:'Protocolos_AtendimentoProtocolo', texto: 'Paciente em atendimento de protocolo assistencial? Se sim, descrever o protocolo na observação.'}, {id: 'Protocolos_DocumentoPreenchido', texto: 'Documento preenchido integralmente?'}, {id: 'Protocolos_TempoRespeitado', texto: 'Tempos dos protocolos respeitados?'}, {id: 'Protocolos_FalhasEvidenciadas', texto: 'Falhas evidenciadas?'} ] } ],
    Cirurgico: [ { titulo: 'Identificação do Paciente', perguntas: [ { id: 'Id_NomePaciente', texto: 'Nome do paciente:' }, { id: 'Id_DataNasc', texto: 'Data de nascimento:'}, {id: 'Id_Sexo', texto: 'Sexo'}, { id: 'Id_NomeMae', texto: 'Nome da mãe:' }, { id: 'Id_Endereco', texto: 'Endereço:' } ] }, { titulo: 'Triagem (em casos de pacientes provenientes da emergência)', perguntas: [ { id: 'Triagem_Realizada', texto: 'Foi realizado triagem?' }, { id: 'Triagem_ClassificacaoCorreta', texto: 'Realizada classificação pelo Protocolo de Manchester?' } ] }, { titulo: 'HDA (em casos de pacientes provenientes da emergência)', perguntas: [ { id: 'HDA_QuadroClinico', texto: 'Possui quadro clinico do paciente?' }, { id: 'HDA_CondutaMedica', texto: 'Possui conduta proposta pelo médico?' }, { id: 'HDA_ExameFisico', texto: 'Possui exame fisico do paciente?' }, { id: 'HDA_Comorbidades', texto: 'Possui comorbidades?' }, { id: 'HDA_Alergias', texto: 'Possui alergias?' }, {id: 'HDA_ExamesComplementares', texto: 'Exames complementares solicitados?'}, { id: 'HDA_HipoteseDiagnostica', texto: 'Possui Hipótese Diagnóstica?' } ] }, { titulo: 'Reconciliação medicamentosa na admissão', perguntas: [ {id: 'Medicacao_Uso', texto: 'Possui medicações que paciente faz o uso?'}, { id: 'Reconciliacao_Dose', texto: 'Possui dose?' }, { id: 'Reconciliacao_Frequencia', texto: 'Possui frequência?' }, {id: 'Medicacao_Mantida', texto: 'Possui a informação se a medicação deve ser mantida ou não? Conciliado na prescrição? Há justificativa em caso de suspensão?'} ] }, { titulo: 'Check list de Transporte Seguro - SBAR', perguntas: [ { id: 'Transporte_Diagnostico', texto: 'Possui diagnóstico?' }, { id: 'Transporte_SinalAlergias', texto: 'Possui sinalização de alergias?' }, { id: 'Transporte_Precaucoes', texto: 'Possui precauções?' }, {id: 'Transporte_MotivoTransferencia', texto: 'Motivo da trasferência registrado?'}, { id: 'Transporte_UnidadeOrigem', texto: 'Possui unidade de origem?' }, { id: 'Transporte_UnidadeDestino', texto: 'Possui unidade de destino?' }, { id: 'Transporte_IdRiscos', texto: 'Possui identificações dos riscos?' }, { id: 'Transporte_SSVVAtualizado', texto: 'Possui SSVV atualizados?' }, { id: 'Transporte_Criterios', texto: 'Possui critérios do transporte?' }, {id: 'Transporte_RecomendacoesPreenchidas', texto: 'Possui recomendações preenchidas para o setor de destino?'} ] }, { titulo: 'Aplicação do Algoritmo de TEV', perguntas: [ { id: 'TEV_Avaliacao24h', texto: 'Realizado avaliação de TEV nas primeiras 24hrs?' }, { id: 'TEV_PrescricaoProtocolo', texto: 'Prescrição esta conforme estabelecido no protocolo?' }, {id: 'Reavaliacao_Diaria_Enfermagem', texto: 'Houve reavaliação diária pela equipe de enfermagem?'} ] }, { titulo: 'SAE ( sistematização da assistência de enfermagem)', perguntas: [ { id: 'SAE_HistoricoEnf', texto: 'Possui histórico de enfermagem preenchido integralmente?' }, { id: 'SAE_DiagnosticoEnf', texto: 'Possui diagnóstico de enfermagem?' }, { id: 'SAE_CuidadosPrescritos', texto: 'Possui cuidados de enfermagem prescritos de acordo com os riscos/diagnósticos?' } ] }, { titulo: 'Avaliação de riscos', perguntas: [ { id: 'Riscos_AvaliacaoQueda', texto: 'Possui avaliação do risco de queda?' }, { id: 'Riscos_AvaliacaoBroncoaspiracao', texto: 'Possui avaliação do risco de broncoaspiração?' }, { id: 'Riscos_AvaliacaoLesao', texto: 'Possui avaliação do risco de lesão?' } ] }, { titulo: 'Plano terapêutico médico', perguntas: [ { id: 'PlanoMedico_BemDefinido', texto: 'Possui plano terapêutico médico descrito?' } ] }, { titulo: 'Plano terapêutico multidisciplinar', perguntas: [ { id: 'PlanoMulti_Existente', texto: 'Possui plano terapêutico multidisciplinar?' }, { id: 'PlanoMulti_Metas', texto: 'Possui metas a serem alcançadas?' }, { id: 'PlanoMulti_Reavaliacao', texto: 'Possui reavaliação?' }, { id: 'PlanoMulti_TodasCategorias', texto: 'Possui plano terapêutico multidisciplinar de todas as categorias que prestam assistência a esse paciente? Caso tenha identificado alguma especialidade que não fez o plano, inserir essa infomação no campo de observações.' } ] }, { titulo: 'Evolução de enfermagem', perguntas: [ { id: 'EvolucaoEnf_InfoClara', texto: 'A evolução contempla a avaliação do paciente baseada nos problemas identificados (ex.: dor, integridade da pele, sinais vitais alterados)? Descreve ações/intervenções de enfermagem realizadas e a resposta do paciente?'} ] }, { titulo: 'Anotação de enfermagem', perguntas: [ { id: 'AnotacaoEnf_InfoClara', texto: 'A anotação do técnico de enfermagem possui precauções, dispositivos, acessos vasculares, registro de condutas realizadas durante o plantão (banho, mudança de decúbito, etc)? Caso tenha identificado alguma não conformidade, inserir a informação no campo de observação.'} ] }, { titulo: 'Evolução médica de admissão', perguntas: [ { id: 'EvolucaoMedica_InfoClara', texto: 'A evolução médica possui informações claras e concisas referente ao diagnóstico do paciente? Caso tenha identificado alguma não conformidade, inserir a informação no campo de observação.' } ] }, { titulo: 'Plano de cuidado paciente e família', perguntas: [ { id: 'PlanoCuidado_InfoRelevante', texto: 'Possui plano de cuidado paciente e família com informações relevantes?' } ] }, { titulo: 'Eventos adversos', perguntas: [ { id: 'Eventos_Identificado', texto: 'Durante sua avaliação de prontuário foi identificado algum evento adverso? caso responda sim, inserir no campo de observações qual evento' }, { id: 'Eventos_Notificado', texto: 'Foi notificado? Existe evidência de notificação em prontuário?' } ] }, { titulo: 'TCLE Cirúrgico', perguntas: [ { id: 'TCLE_Cirurgico', texto: 'Aplicado termo de consentimento esclarecido para procedimento cirúrgico, com assinatura do profissional e paciente ou responsável?' } ] }, { titulo: 'TCLE Anestésico', perguntas: [ { id: 'TCLE_Anestesico', texto: 'Aplicado termo de consentimento esclarecido anestésico/sedação, com assinatura do profissional e paciente ou responsável?'} ] }, {titulo: 'Consulta pré-anestésica', perguntas: [ {id: 'ConsultaPre_Registrada', texto: 'Consulta pré anestésica registrada?'} ] }, {titulo: 'Boletim Anestésico', perguntas: [ {id:'Boletim_Preenchido', texto: 'Boletim anestésico preenchido integralmente?'} ] }, { titulo: 'Check List de cirurgia segura', perguntas: [ { id: 'Checklist_SignIn', texto: 'Sign-In (Antes da indução anestésica), preenchido todas as etapas?' }, { id: 'Checklist_Demarcacao', texto: 'Local de cirurgia foi demarcado?' }, { id: 'Checklist_TimeOut', texto: 'Time- Out (antes da incisão cirurgica),preenchido todas as etapas?' }, { id: 'Checklist_Profilaxia60min', texto: 'A profilaxia antimicrobiana foi realizada em até 60min?' }, { id: 'Checklist_SignOut', texto: 'Sing- Out (Antes da saída da sala de cirurgia),preenchido todas as etapas?' }, { id: 'Checklist_Contagem', texto: 'Contagem de instrumentos, compressas e agulhas?' } ] }, {titulo: 'Check List de Parto Seguro', perguntas: [ {id: 'Parto_PrimeiraEtapa', texto: '1- Primeira etapa realizada (Admissão)?'}, {id: 'Parto_StatusParto', texto: '1.1 - Status do parto (eletivo/urgência) com motivo está documentado?'}, {id: 'Parto_ClassificaoRobson', texto: '1.2 - Classificação de Robson está registrada?'}, {id: 'Parto_DadosClinicos', texto: '1.3 - Dados clínicos principais (sinais vitais, BCF) estão completos?'}, {id: 'Parto_SegundaEtapa', texto: '2 - Segunda etapa realizada (Antes da anestesia e procedimeto na sala obstétrica)?'}, {id: 'Parto_Tipo&Hemorragia', texto: '2.1 - Tipo de parto e risco de hemorragia estão documentados?'}, {id: 'Parto_ATBCesarea', texto: '2.2 - Em caso de cesárea, antibiótico foi registrado?'}, {id: 'Parto_TerceiraEtapa', texto: '3 - Terceira etapa realizada (Após o nascimento)?'}, {id: 'Parto_CampleamentoCordao', texto: '3.1 -Clampeamento do cordão foi realizado e anotado?'}, {id: 'Parto_CompressasRegistradas', texto: '3.2 - Compressas e encaminhamento da placenta foram registrados?'}, {id:'Parto_SangramentoDocumentado', texto: '3.3 - Sangramento >500 ml foi documentado (se aplicável)?'}, {id: 'Parto_Apgar', texto: '3.4 - Apgar no 1º e 5º minuto foi registrado?'}, {id: 'Parto_Profilaxias', texto: '3.5 - Profilaxias (Vitamina K, Iodopovidona) foram registradas?'}, {id: 'Parto_QuartaEtapa', texto: '4 - Quarta etapa realizada (Alta)?'}, {id:'Parto_IdentificacaoBinomio', texto: '4.1 - Registro de conferencia de identificação do binômio antes da alta?'}, {id: 'Parto_SSVVPuerpura', texto: '4.2 - SSVV da puérpera registrados?'}, {id: 'Parto_SSVVRn', texto: '4.3 - SSVV do RN registrados?'} ] }, { titulo: 'Sumário de Alta', perguntas: [ { id: 'Alta_Sumario', texto: 'Possui sumário de alta?' }, { id: 'Alta_Orientacoes', texto: 'Possui orientações pós alta?' } ] }, { titulo: 'Siglas', perguntas: [ { id: 'Final_UsoInadequadoSiglas', texto: 'Todas as siglas evidenciadas nos registros estão padronizadas em siglário da instituição?' } ] } ],
    Fonoaudiologia: [ { titulo: 'Evolução fonoaudiológica adulto', perguntas: [ { id: 'EvolucaoAdulto_DocMV', texto: 'Há o documento de evolução fonoaudiológica no Sistema MV?' }, { id: 'EvolucaoAdulto_GrauDisfagia', texto: 'Possui grau de disfagia?' }, { id: 'EvolucaoAdulto_ConsistenciaDieta', texto: 'Possui consistência da dieta? (Caso via oral)' }, { id: 'EvolucaoAdulto_DietaSugerida', texto: 'Existe dieta sugerida?' }, { id: 'EvolucaoAdulto_Conduta', texto: 'Há a conduta fonoaudiológica?' } ] }, { titulo: 'Evolução fonoaudiológica pediátrica', perguntas: [ { id: 'EvolucaoPed_DocMV', texto: 'Há o documento de evolução fonoaudiológica no Sistema MV?' }, { id: 'EvolucaoPed_Conduta', texto: 'Tem conduta fonoaudiológica?' } ] }, { titulo: 'Teste da orelhinha', perguntas: [ { id: 'Orelhinha_DocMV', texto: 'Há o documento no Sistema MV?' }, { id: 'Orelhinha_Resultado', texto: 'Há o resultado após o teste?' } ] }, { titulo: 'Siglas', perguntas: [ { id: 'Final_UsoInadequadoSiglas', texto: 'Todas as siglas evidenciadas nos registros são padronizadas em siglário da instituição?' } ] } ],
    Fisioterapia: [ { titulo: 'Evolução fisioterapêutica adulto', perguntas: [ { id: 'EvolucaoAdulto_DocMV', texto: 'Há documento fisioterapêutica no MV?' }, { id: 'EvolucaoAdulto_NivelAtividade', texto: 'Possui nível de atividade pregressa?' }, { id: 'EvolucaoAdulto_DeficitForca', texto: 'Possui deficit de força e funcionalidade?' }, { id: 'EvolucaoAdulto_ProjetoTerapeutico', texto: 'Existe projeto terapêutico funcional e respiratório?'}, {id: 'EvolucaoAdulto_conduta_terapeutica', texto: 'Há condutas fisioterapêuticas?' }, { id: 'EvolucaoAdulto_MudancaConduta', texto: 'Em caso de mudanças de condução respiratória (VNI / IOT / ExTOT / TQT / MNBZ) existe datas correspondentes? E incluiu no cabeçalho da evolução?' } ] }, { titulo: 'Evolução fisioterapêutica pediátrica', perguntas: [ { id: 'EvolucaoPed_DocMV', texto: 'Há evolução fisioterapêutica no sistema?' }, { id: 'EvolucaoPed_Conduta', texto: 'Há conduta?' }, { id: 'EvolucaoPed_PlanoTerapeutico', texto: 'Existe plano terapêutico?' } ] }, { titulo: 'Testes', perguntas: [ { id: 'Testes_Manovacuometria', texto: 'Possui teste de Manovacuometria?' }, { id: 'Testes_Dinamometria', texto: 'Possui teste de Dinamometria?' }, { id: 'Testes_DiarioCaminhada', texto: 'Possui diário de caminhada?' }, { id: 'Testes_DistanciaPercorrida', texto: 'Possui preenchimento de distância percorrida?' } ] }, { titulo: 'Siglas', perguntas: [ { id: 'Final_UsoInadequadoSiglas', texto: 'Todas as siglas evidenciadas nos registros são padronizadas em siglário da instituição?' } ] } ]
  };

  function criarPergunta(container, prefixo, pergunta) { const nomeBase = `${prefixo}_${pergunta.id}`; const row = document.createElement('div'); row.className = 'question-row'; row.innerHTML = ` <div class="question-text">- ${pergunta.texto}</div> <div class="responses"> <div class="form-check form-check-inline"> <input class="form-check-input" type="radio" name="${nomeBase}_Resp" value="Sim"><label class="form-check-label">Sim</label> </div> <div class="form-check form-check-inline"> <input class="form-check-input" type="radio" name="${nomeBase}_Resp" value="Não"><label class="form-check-label">Não</label> </div> <div class="form-check form-check-inline"> <input class="form-check-input" type="radio" name="${nomeBase}_Resp" value="N/A"><label class="form-check-label">N/A</label> </div> </div> <input type="text" class="form-control form-control-sm obs-input" name="${nomeBase}_Obs" placeholder="Observação"> `; container.appendChild(row); }

  window.addEventListener('load', function() { try { const dadosPagina1 = JSON.parse(sessionStorage.getItem('dadosPagina1')); if (!dadosPagina1) { alert('Erro: Dados da página 1 não encontrados. Por favor, comece novamente.'); window.location.href = '/'; return; } const tipoAvaliacao = dadosPagina1.tipoAvaliacao; const container = document.getElementById('questionario-container'); const titulo = document.getElementById('questionario-titulo'); titulo.innerHTML = `Questionário de Avaliação: <span class="badge badge-secondary">${tipoAvaliacao}</span>`; const estrutura = ESTRUTURA_FORMULARIO[tipoAvaliacao]; if (!estrutura) { alert(`Erro: Tipo de avaliação "${tipoAvaliacao}" não reconhecido.`); return; } estrutura.forEach(grupo => { const groupDiv = document.createElement('div'); groupDiv.className = 'question-group'; const h5 = document.createElement('h5'); h5.textContent = grupo.titulo; groupDiv.appendChild(h5); grupo.perguntas.forEach(pergunta => { criarPergunta(groupDiv, tipoAvaliacao, pergunta); }); container.appendChild(groupDiv); }); document.getElementById('btnSalvar').addEventListener('click', submeterFormulario); } catch(e) { alert("Ocorreu um erro ao carregar o questionário: " + e.message); window.location.href = '/'; } });

  // NOVA FUNÇÃO PARA O BOTÃO VOLTAR
  function voltarParaPagina1() {
    window.location.href = "/"; 
  }

  // FUNÇÃO DE SALVAR COM VALIDAÇÃO
  function submeterFormulario() {
    try {
      let primeiraPerguntaNaoRespondida = null;
      const todasAsPerguntas = document.querySelectorAll('.question-row');
      todasAsPerguntas.forEach(row => { row.classList.remove('unanswered'); });
      for (const pergunta of todasAsPerguntas) {
        const radios = pergunta.querySelectorAll('input[type="radio"]');
        const algumaOpcaoMarcada = Array.from(radios).some(radio => radio.checked);
        if (!algumaOpcaoMarcada) {
          pergunta.classList.add('unanswered');
          if (!primeiraPerguntaNaoRespondida) {
            primeiraPerguntaNaoRespondida = pergunta;
          }
        }
      }
      if (primeiraPerguntaNaoRespondida) {
        alert('Por favor, responda todas as perguntas antes de salvar. As perguntas não respondidas estão destacadas em vermelho.');
        primeiraPerguntaNaoRespondida.scrollIntoView({ behavior: 'smooth', block: 'center' });
        return;
      }

      const btn = document.getElementById('btnSalvar');
      btn.disabled = true;
      btn.innerHTML = 'Salvando...';

      const dadosPagina1 = JSON.parse(sessionStorage.getItem('dadosPagina1'));
      const form = document.getElementById('formCompleto');
      const formData = new FormData(form);
      const dadosPagina2 = Object.fromEntries(formData.entries());
      const dadosCompletos = { ...dadosPagina1, ...dadosPagina2 };

      fetch('/api/salvar-dados', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(dadosCompletos),
      })
      .then(response => {
        if (!response.ok) {
            return response.json().then(err => { throw new Error(err.message || 'Erro desconhecido no servidor') });
        }
        return response.json();
      })
      .then(data => {
        alert(data.message);
        if (data.message.startsWith("✅")) {
          window.location.href = "/";
        } else {
          btn.disabled = false;
          btn.innerHTML = 'Salvar Avaliação Completa';
        }
      })
      .catch(error => {
        console.error('Erro de comunicação:', error);
        alert('Erro de comunicação com o servidor: ' + error.message);
        btn.disabled = false;
        btn.innerHTML = 'Salvar Avaliação Completa';
      });
    } catch (e) {
      alert("Erro no script do formulário:\n\n" + e.name + ": " + e.message);
      const btn = document.getElementById('btnSalvar');
      if(btn) {
        btn.disabled = false;
        btn.innerHTML = 'Salvar Avaliação Completa';
      }
    }
  }
</script>
</body>
</html>